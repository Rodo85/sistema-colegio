<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAS - {{ grupo_nombre }}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @page {
      size: 150mm 250mm;
      margin: 0;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 10pt;
      line-height: 1.4;
      background: #fff;
      color: #000;
    }

    .pas-container {
      width: 150mm;
      height: 250mm;
      padding: 0;
      margin: 0 auto;
      background: white;
      page-break-after: always;
    }

    .pas-container:last-child {
      page-break-after: auto;
    }

    /* Bloque superior con logo y datos - con borde gris opaco */
    .bloque-superior {
      border: 1px solid rgba(128, 128, 128, 0.2);
      padding: 5mm;
      margin-bottom: 5mm;
    }

    /* Logo institucional centrado */
    .logo-container {
      text-align: center;
      margin-bottom: 4mm;
    }

    .logo-container img {
      max-width: 70mm;
      max-height: 35mm;
      object-fit: contain;
    }

    /* Foto del estudiante centrada */
    .foto-container {
      text-align: center;
      margin-bottom: 4mm;
    }

    .foto-container img {
      width: 45mm;
      height: 55mm;
      object-fit: cover;
      border: 1px solid #666;
      border-radius: 2mm;
      display: inline-block;
    }

    /* Nombre del estudiante */
    .nombre-estudiante {
      text-align: center;
      font-size: 13pt;
      font-weight: 700;
      margin-bottom: 3mm;
      text-transform: uppercase;
    }

    /* Identificación del estudiante */
    .identificacion-estudiante {
      text-align: center;
      font-size: 11pt;
      font-weight: 700;
      margin-bottom: 8mm;
      text-transform: uppercase;
    }

    /* Fecha nacimiento */
    .fecha-nacimiento {
      text-align: center;
      font-size: 10pt;
      margin-bottom: 8mm;
    }

    /* Sección QR y datos */
    .qr-datos-container {
      display: flex;
      gap: 5mm;
      align-items: flex-start;
    }

    /* QR con bordes celestes en esquinas */
    .qr-wrapper {
      flex: 0 0 40mm;
      position: relative;
      padding: 2mm;
    }

    .qr-wrapper::before,
    .qr-wrapper::after {
      content: '';
      position: absolute;
      width: 10mm;
      height: 10mm;
      border: 2px solid #4fc3f7;
    }

    .qr-wrapper::before {
      top: 0;
      left: 0;
      border-right: none;
      border-bottom: none;
    }

    .qr-wrapper::after {
      bottom: 0;
      right: 0;
      border-left: none;
      border-top: none;
    }

    .qr-esquina-tr,
    .qr-esquina-bl {
      position: absolute;
      width: 10mm;
      height: 10mm;
      border: 2px solid #4fc3f7;
    }

    .qr-esquina-tr {
      top: 0;
      right: 0;
      border-left: none;
      border-bottom: none;
    }

    .qr-esquina-bl {
      bottom: 0;
      left: 0;
      border-right: none;
      border-top: none;
    }

    .qr-code {
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .qr-code img {
      width: 35mm;
      height: 35mm;
      display: block;
      margin: 0 auto;
    }

    /* Datos a la derecha del QR */
    .datos-derecha {
      flex: 1;
      font-size: 9.5pt;
      line-height: 1.8;
    }

    .datos-derecha p {
      margin-bottom: 3mm;
    }

    .datos-derecha strong {
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Bloque de especialidad */
    .bloque-especialidad {
      background: #E8F9FF;
      padding: 4mm;
      margin-bottom: 5mm;
      text-align: center;
      min-height: 12mm;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11pt;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Sección final */
    .seccion-final {
      padding: 5mm;
      text-align: center;
    }

    .campo-seccion {
      display: inline-block;
    }

    .campo-seccion strong {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 11pt;
      margin-right: 3mm;
    }

    .linea-seccion {
      display: inline-block;
      border-bottom: 1px solid #333;
      width: 60mm;
    }

    /* Impresión */
    @media print {
      body {
        background: white;
      }

      .pas-container {
        width: 150mm;
        height: 250mm;
      }

      @page {
        size: 150mm 250mm;
        margin: 0;
      }
    }
  </style>
</head>
<body onload="window.print();">
  {% for data in estudiantes_data %}
  <div class="pas-container">
    <!-- Bloque superior con borde gris -->
    <div class="bloque-superior">
      <!-- Logo institucional -->
      <div class="logo-container">
        {% if institucion.logo %}
          <img src="{{ institucion.logo.url }}" alt="Logo">
        {% endif %}
      </div>

      <!-- Foto del estudiante -->
      <div class="foto-container">
        {% if data.estudiante.foto %}
          <img src="{{ data.estudiante.foto.url }}" alt="Foto">
        {% else %}
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='240'%3E%3Crect fill='%23eee' width='200' height='240'/%3E%3Ctext x='50%25' y='50%25' font-size='16' text-anchor='middle' fill='%23999'%3ESin foto%3C/text%3E%3C/svg%3E" alt="Sin foto">
        {% endif %}
      </div>

      <!-- Nombre del estudiante -->
      <div class="nombre-estudiante">
        {{ data.estudiante.nombres }} {{ data.estudiante.primer_apellido }} {{ data.estudiante.segundo_apellido|default:"" }}
      </div>

      <!-- Identificación del estudiante -->
      <div class="identificacion-estudiante">
        IDENTIFICACIÓN: {{ data.estudiante.identificacion }}
      </div>

      <!-- Fecha de nacimiento -->
      <div class="fecha-nacimiento">
        <strong>FECHA DE NACIMIENTO:</strong> {% if data.estudiante.fecha_nacimiento %}{{ data.estudiante.fecha_nacimiento|date:"j \d\e F \d\e\l Y" }}{% else %}---{% endif %}
      </div>

      <!-- QR y datos -->
      <div class="qr-datos-container">
        <!-- QR con bordes celestes -->
        <div class="qr-wrapper">
          <span class="qr-esquina-tr"></span>
          <span class="qr-esquina-bl"></span>
          <div class="qr-code">
            <img src="data:image/png;base64,{{ data.qr_code_base64 }}" alt="QR">
          </div>
        </div>

        <!-- Datos a la derecha -->
        <div class="datos-derecha">
          <p><strong>Domicilio:</strong> {{ data.estudiante.provincia.nombre|default:"---" }}, {{ data.estudiante.canton.nombre|default:"---" }}, {{ data.estudiante.distrito.nombre|default:"---" }}</p>
          {% if data.contacto_principal %}
          <p><strong>Encargado:</strong> {{ data.contacto_principal.persona_contacto }} ({{ data.contacto_principal.parentesco }})</p>
          <p><strong>Teléfono:</strong> {{ data.contacto_principal.persona_contacto.celular_avisos|default:"---" }}</p>
          {% else %}
          <p><strong>Encargado:</strong> No registrado</p>
          <p><strong>Teléfono:</strong> ---</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Bloque de especialidad con background celeste -->
    <div class="bloque-especialidad">
      {% if data.matricula.especialidad %}{{ data.matricula.especialidad.especialidad.nombre }}{% endif %}
    </div>

    <!-- Sección final con campo centrado -->
    <div class="seccion-final">
      <div class="campo-seccion">
        <strong>Sección:</strong><span class="linea-seccion"></span>
      </div>
    </div>
  </div>
  {% endfor %}
</body>
</html>
