<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAS - {{ estudiante.identificacion }}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @page {
      size: 115mm 190mm;
      margin: 5mm;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 9pt;
      line-height: 1.3;
      background: #fff;
      color: #000;
    }

    .pas-container {
      width: 105mm;
      height: 180mm;
      padding: 4mm;
      border: 1px solid #ccc;
      margin: 0 auto;
      background: white;
    }

    /* Logo institucional centrado */
    .logo-container {
      text-align: center;
      margin-bottom: 3mm;
    }

    .logo-container img {
      max-width: 60mm;
      max-height: 30mm;
      object-fit: contain;
    }

    /* Foto del estudiante centrada */
    .foto-container {
      text-align: center;
      margin-bottom: 3mm;
    }

    .foto-container img {
      width: 40mm;
      height: 50mm;
      object-fit: cover;
      border: 1px solid #666;
      border-radius: 2mm;
      display: inline-block;
    }

    /* Nombre del estudiante */
    .nombre-estudiante {
      text-align: center;
      font-size: 12pt;
      font-weight: 700;
      margin-bottom: 2mm;
      text-transform: uppercase;
    }

    /* Fecha nacimiento */
    .fecha-nacimiento {
      text-align: center;
      font-size: 9pt;
      margin-bottom: 4mm;
    }

    /* Sección QR y datos */
    .qr-datos-container {
      display: flex;
      gap: 3mm;
      margin-bottom: 4mm;
      align-items: flex-start;
    }

    /* QR con bordes celestes en esquinas */
    .qr-wrapper {
      flex: 0 0 35mm;
      position: relative;
      padding: 2mm;
    }

    .qr-wrapper::before,
    .qr-wrapper::after {
      content: '';
      position: absolute;
      width: 8mm;
      height: 8mm;
      border: 2px solid #4fc3f7;
    }

    .qr-wrapper::before {
      top: 0;
      left: 0;
      border-right: none;
      border-bottom: none;
    }

    .qr-wrapper::after {
      bottom: 0;
      right: 0;
      border-left: none;
      border-top: none;
    }

    .qr-esquina-tr,
    .qr-esquina-bl {
      position: absolute;
      width: 8mm;
      height: 8mm;
      border: 2px solid #4fc3f7;
    }

    .qr-esquina-tr {
      top: 0;
      right: 0;
      border-left: none;
      border-bottom: none;
    }

    .qr-esquina-bl {
      bottom: 0;
      left: 0;
      border-right: none;
      border-top: none;
    }

    .qr-code {
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .qr-code img {
      width: 30mm;
      height: 30mm;
      display: block;
      margin: 0 auto;
    }

    /* Datos a la derecha del QR */
    .datos-derecha {
      flex: 1;
      font-size: 8.5pt;
      line-height: 1.6;
    }

    .datos-derecha p {
      margin-bottom: 2mm;
    }

    .datos-derecha strong {
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Franja de especialidad */
    .franja-especialidad {
      background: #e1f5fe;
      padding: 2mm;
      margin-bottom: 3mm;
      text-align: center;
      min-height: 8mm;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10pt;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Sección final */
    .seccion-final {
      margin-top: 3mm;
      padding-top: 3mm;
      border-top: 1px solid #ccc;
      font-size: 9pt;
      line-height: 1.8;
    }

    .seccion-final p {
      margin-bottom: 2mm;
    }

    .seccion-final strong {
      font-weight: 700;
      text-transform: uppercase;
    }

    .linea-manual {
      display: inline-block;
      border-bottom: 1px solid #000;
      width: 50mm;
      margin-left: 2mm;
    }

    /* Impresión */
    @media print {
      body {
        background: white;
      }

      .pas-container {
        border: none;
        width: 105mm;
        height: 180mm;
      }

      @page {
        size: 115mm 190mm;
        margin: 5mm;
      }
    }
  </style>
</head>
<body onload="window.print();">
  <div class="pas-container">
    <!-- Logo institucional -->
    <div class="logo-container">
      {% if institucion.logo %}
        <img src="{{ institucion.logo.url }}" alt="Logo">
      {% endif %}
    </div>

    <!-- Foto del estudiante -->
    <div class="foto-container">
      {% if estudiante.foto %}
        <img src="{{ estudiante.foto.url }}" alt="Foto">
      {% else %}
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='240'%3E%3Crect fill='%23eee' width='200' height='240'/%3E%3Ctext x='50%25' y='50%25' font-size='16' text-anchor='middle' fill='%23999'%3ESin foto%3C/text%3E%3C/svg%3E" alt="Sin foto">
      {% endif %}
    </div>

    <!-- Nombre del estudiante -->
    <div class="nombre-estudiante">
      {{ estudiante.nombres }} {{ estudiante.primer_apellido }} {{ estudiante.segundo_apellido|default:"" }}
    </div>

    <!-- Fecha de nacimiento -->
    <div class="fecha-nacimiento">
      <strong>FECHA DE NACIMIENTO:</strong> {% if estudiante.fecha_nacimiento %}{{ estudiante.fecha_nacimiento|date:"j \d\e F \d\e\l Y" }}{% else %}---{% endif %}
    </div>

    <!-- QR y datos -->
    <div class="qr-datos-container">
      <!-- QR con bordes celestes -->
      <div class="qr-wrapper">
        <span class="qr-esquina-tr"></span>
        <span class="qr-esquina-bl"></span>
        <div class="qr-code">
          <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QR">
        </div>
      </div>

      <!-- Datos a la derecha -->
      <div class="datos-derecha">
        <p><strong>Domicilio:</strong> {{ estudiante.provincia.nombre|default:"---" }}, {{ estudiante.canton.nombre|default:"---" }}, {{ estudiante.distrito.nombre|default:"---" }}</p>
        {% if contacto_principal %}
        <p><strong>Encargado:</strong> {{ contacto_principal.persona_contacto }} ({{ contacto_principal.parentesco }})</p>
        <p><strong>Teléfono:</strong> {{ contacto_principal.persona_contacto.celular_avisos|default:"---" }}</p>
        {% else %}
        <p><strong>Encargado:</strong> No registrado</p>
        <p><strong>Teléfono:</strong> ---</p>
        {% endif %}
      </div>
    </div>

    <!-- Franja de especialidad -->
    <div class="franja-especialidad">
      {% if matricula.especialidad %}{{ matricula.especialidad.especialidad.nombre }}{% endif %}
    </div>

    <!-- Sección final -->
    <div class="seccion-final">
      <p><strong>Nivel:</strong><span class="linea-manual"></span></p>
      <p><strong>Sección:</strong><span class="linea-manual"></span></p>
    </div>
  </div>
</body>
</html>
