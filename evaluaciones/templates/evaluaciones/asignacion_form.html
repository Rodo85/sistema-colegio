{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}{{ accion }} Asignación Docente{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
:root{--primary:#1a6eb5;--primary-dark:#145591;--success:#198754;--border:#dee2e6;--surface:#f8f9fc;--muted:#6c757d;}
.page-wrap{max-width:700px;margin:28px auto;padding:0 16px;font-family:"Segoe UI",system-ui,sans-serif;}
.page-title{font-size:1.55rem;font-weight:700;color:var(--primary-dark);margin-bottom:28px;}
.card{background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);}
.card-header{background:var(--surface);border-bottom:1px solid var(--border);padding:14px 20px;border-radius:10px 10px 0 0;display:flex;align-items:center;gap:10px;}
.card-header h2{margin:0;font-size:1rem;font-weight:600;color:var(--primary-dark);}
.card-body{padding:24px;}
.form-group{margin-bottom:18px;}
.form-group label{display:block;font-size:.82rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;}
.form-control{width:100%;padding:9px 13px;border:1px solid var(--border);border-radius:6px;font-size:.95rem;box-sizing:border-box;}
.form-control:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(26,110,181,.15);}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;font-size:.95rem;font-weight:600;border-radius:6px;border:none;cursor:pointer;text-decoration:none;transition:filter .15s;}
.btn:hover{filter:brightness(1.08);}
.btn-primary{background:var(--primary);color:#fff;}
.btn-outline{background:#fff;color:var(--primary);border:1px solid var(--primary);}
.alert{padding:12px 16px;border-radius:8px;margin-bottom:18px;font-size:.92rem;}
.alert-danger{background:#fef2f2;border:1px solid #fecaca;color:#991b1b;}
.error-list{list-style:none;padding:0;margin:4px 0 0;}
.error-list li{font-size:.83rem;color:#991b1b;}
.info-box{background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;padding:12px 16px;font-size:.88rem;color:#1e40af;margin-bottom:18px;}
</style>
{% endblock %}

{% block content %}
<div class="page-wrap">
  <div class="page-title"><i class="fas fa-chalkboard-teacher"></i> {{ accion }} Asignación Docente</div>

  {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}

  <div class="info-box">
    <i class="fas fa-info-circle"></i>
    <strong>Reglas:</strong>
    Materias académicas → asignar por <strong>Sección</strong> (dejar Subgrupo vacío).
    Materias técnicas → asignar por <strong>Subgrupo</strong> (dejar Sección vacía).
    El esquema de evaluación se copia automáticamente del subárea-curso al crear la asignación.
  </div>

  <div class="card">
    <div class="card-header">
      <i class="fas fa-user-edit" style="color:var(--primary)"></i>
      <h2>{{ accion }} asignación{% if curso_lectivo %} — {{ curso_lectivo.nombre }}{% endif %}</h2>
    </div>
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        {% if es_superusuario %}
          <input type="hidden" name="institucion" value="{{ institucion.pk }}">
        {% endif %}
        {% if curso_lectivo %}
          <input type="hidden" name="curso_lectivo" value="{{ curso_lectivo.pk }}">
        {% endif %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {% for err in form.non_field_errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        {% endif %}

        {% for field in form.visible_fields %}
          {% if field.name != "curso_lectivo" %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
              <ul class="error-list">{% for e in field.errors %}<li>{{ e }}</li>{% endfor %}</ul>
            {% endif %}
            {% if field.help_text %}
              <small style="color:var(--muted);font-size:.8rem;">{{ field.help_text }}</small>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}

        <div style="display:flex;gap:10px;margin-top:10px;">
          <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> {{ accion }}</button>
          <a href="{% url 'evaluaciones:docentes' %}{% if institucion %}?{% if es_superusuario %}institucion={{ institucion.pk }}&{% endif %}{% if curso_lectivo %}curso_lectivo={{ curso_lectivo.pk }}{% endif %}{% endif %}"
             class="btn btn-outline"><i class="fas fa-arrow-left"></i> Volver</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
